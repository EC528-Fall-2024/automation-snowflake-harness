2024-11-05 12:39:42,071 - INFO - Starting the migration process.
2024-11-05 12:39:42,071 - INFO - Snowflake Credentials: {'user': 'EC528AUTOMATION2', 'password': '********', 'account': 'ittvgex-il72605', 'warehouse': 'COMPUTE_WH', 'database': 'TEST', 'schema': 'PUBLIC'}
2024-11-05 12:39:42,071 - INFO - Connecting to Snowflake...
2024-11-05 12:39:42,071 - INFO - Snowflake Connector for Python Version: 3.12.2, Python Version: 3.10.9, Platform: macOS-10.16-x86_64-i386-64bit
2024-11-05 12:39:42,072 - INFO - Connecting to GLOBAL Snowflake domain
2024-11-05 12:39:42,072 - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2024-11-05 12:39:42,654 - INFO - Connection to Snowflake established successfully.
2024-11-05 12:39:43,165 - INFO - Number of results in first chunk: 1
2024-11-05 12:39:43,166 - INFO - Database TEST created successfully (if it didn't already exist).
2024-11-05 12:39:43,251 - INFO - Number of results in first chunk: 1
2024-11-05 12:39:43,340 - INFO - Number of results in first chunk: 1
2024-11-05 12:39:43,340 - INFO - Schema PUBLIC created successfully.
2024-11-05 12:39:43,340 - INFO - closed
2024-11-05 12:39:43,392 - INFO - No async queries seem to be running, deleting session
2024-11-05 12:39:43,443 - INFO - Connecting to Snowflake...
2024-11-05 12:39:43,443 - INFO - Snowflake Connector for Python Version: 3.12.2, Python Version: 3.10.9, Platform: macOS-10.16-x86_64-i386-64bit
2024-11-05 12:39:43,443 - INFO - Connecting to GLOBAL Snowflake domain
2024-11-05 12:39:43,443 - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2024-11-05 12:39:43,740 - INFO - Connection to Snowflake established successfully.
2024-11-05 12:39:44,147 - INFO - Number of results in first chunk: 1
2024-11-05 12:39:44,267 - INFO - Number of results in first chunk: 0
2024-11-05 12:39:44,346 - INFO - Number of results in first chunk: 0
2024-11-05 12:39:44,347 - INFO - Successfully retrieved database objects.
2024-11-05 12:39:44,347 - INFO - closed
2024-11-05 12:39:44,392 - INFO - No async queries seem to be running, deleting session
2024-11-05 12:39:44,512 - INFO - Total changesets generated: 1
2024-11-05 12:39:44,515 - INFO - Changelog written to migrations/generated_changelog_20241105_123943.yaml
2024-11-05 12:39:44,519 - INFO - Changelog validation successful. Total changesets: 1
2024-11-05 12:39:44,519 - INFO - Changeset IDs:
2024-11-05 12:39:44,519 - INFO -   create-template-warehouse
2024-11-05 12:39:44,519 - INFO - Constructed Snowflake URL: jdbc:snowflake://ittvgex-il72605.snowflakecomputing.com/?user=EC528AUTOMATION2&password=********&warehouse=COMPUTE_WH&database=TEST&schema=PUBLIC
2024-11-05 12:39:44,519 - INFO - Starting Liquibase migration using changelog: migrations/generated_changelog_20241105_123943.yaml
2024-11-05 12:39:49,418 - INFO - Running migration with command: liquibase --changeLogFile=migrations/generated_changelog_20241105_123943.yaml --url=jdbc:snowflake://ittvgex-il72605.snowflakecomputing.com/?user=EC528AUTOMATION2&password=Chesterfield4396@&warehouse=COMPUTE_WH&database=TEST&schema=PUBLIC --defaultSchemaName=PUBLIC update
2024-11-05 12:39:51,837 - ERROR - Error running Liquibase migration:
Command: ['liquibase', '--changeLogFile=migrations/generated_changelog_20241105_123943.yaml', '--url=jdbc:snowflake://ittvgex-il72605.snowflakecomputing.com/?user=EC528AUTOMATION2&password=Chesterfield4396@&warehouse=COMPUTE_WH&database=TEST&schema=PUBLIC', '--defaultSchemaName=PUBLIC', 'update']
Return Code: 1
STDOUT: 
STDERR: ####################################################
##   _     _             _ _                      ##
##  | |   (_)           (_) |                     ##
##  | |    _  __ _ _   _ _| |__   __ _ ___  ___   ##
##  | |   | |/ _` | | | | | '_ \ / _` / __|/ _ \  ##
##  | |___| | (_| | |_| | | |_) | (_| \__ \  __/  ##
##  \_____/_|\__, |\__,_|_|_.__/ \__,_|___/\___|  ##
##              | |                               ##
##              |_|                               ##
##                                                ## 
##  Get documentation at docs.liquibase.com       ##
##  Get certified courses at learn.liquibase.com  ## 
##                                                ##
####################################################
Starting Liquibase at 12:39:51 using Java 23 (version 4.29.2 #3683 built at 2024-08-29 16:45+0000)
Liquibase Version: 4.29.2
Liquibase Open Source 4.29.2 by Liquibase
ERROR: Exception Details
ERROR: Exception Primary Class:  ClassCastException
ERROR: Exception Primary Reason:  class java.lang.String cannot be cast to class liquibase.database.Database (java.lang.String is in module java.base of loader 'bootstrap'; liquibase.database.Database is in unnamed module of loader java.net.URLClassLoader @4a574795)
ERROR: Exception Primary Source:  4.29.2

Unexpected error running Liquibase: class java.lang.String cannot be cast to class liquibase.database.Database (java.lang.String is in module java.base of loader 'bootstrap'; liquibase.database.Database is in unnamed module of loader java.net.URLClassLoader @4a574795)

For more information, please use the --log-level flag

2024-11-05 12:39:51,838 - ERROR - Migration process failed: Command '['liquibase', '--changeLogFile=migrations/generated_changelog_20241105_123943.yaml', '--url=jdbc:snowflake://ittvgex-il72605.snowflakecomputing.com/?user=EC528AUTOMATION2&password=Chesterfield4396@&warehouse=COMPUTE_WH&database=TEST&schema=PUBLIC', '--defaultSchemaName=PUBLIC', 'update']' returned non-zero exit status 1.
Traceback (most recent call last):
  File "/Users/krish/Desktop/BU/Fall 2024/EC528/automation-snowflake-harness/main.py", line 65, in main
    migration_manager.run_migration(changelog_file)
  File "/Users/krish/Desktop/BU/Fall 2024/EC528/automation-snowflake-harness/scripts/migration_manager.py", line 90, in run_migration
    result = subprocess.run(update_command, check=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True)
  File "/Users/krish/anaconda3/lib/python3.10/subprocess.py", line 526, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['liquibase', '--changeLogFile=migrations/generated_changelog_20241105_123943.yaml', '--url=jdbc:snowflake://ittvgex-il72605.snowflakecomputing.com/?user=EC528AUTOMATION2&password=Chesterfield4396@&warehouse=COMPUTE_WH&database=TEST&schema=PUBLIC', '--defaultSchemaName=PUBLIC', 'update']' returned non-zero exit status 1.
